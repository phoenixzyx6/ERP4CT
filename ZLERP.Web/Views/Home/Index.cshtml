@{
    ViewBag.Title = "首页";
    Layout = null;
    Html.IncludeJs(
        "~/Scripts/jquery-1.4.4.min.js",
        "~/Scripts/jquery.loadmask.js",
        "~/Scripts/jquery-ui.js",
        "~/Scripts/jquery.pnotify.min.js",
        "~/Scripts/jquery.validate.min.js",
        "~/Scripts/jquery.validate.unobtrusive.min.js",
        "~/Scripts/jquery-ui-timepicker-addon.js",
        "~/Scripts/i18n/grid.locale-cn.js",
        "~/Scripts/i18n/jquery.ui.locale.zh-CN.js",
        "~/Scripts/jquery.jqGrid.min.js",
        "~/Scripts/jquery.tmpl.min.js",
        "~/Scripts/json2.js",
        "~/Scripts/jquery.ztree.core-3.2.min.js",
        "~/Scripts/jquery.ztree.excheck-3.2.min.js",
        "~/Scripts/jquery.layout.js",
        "~/Scripts/date.js",
        "~/Scripts/fg.menu.js",
        "~/Scripts/jquery.messager.js",
        "~/Scripts/common.js",
        "~/Scripts/MyGrid.js",
        "~/Scripts/jquery.jqGrid.groupHeader-0.2.1.js",
        "~/Scripts/jquery.zlerp.js",
        "~/Scripts/ActReport.js",
        "~/Scripts/abc/mapabc.custom.v1.1.js"
        //,"~/Scripts/jquery.cookie.js"
    );

    Html.IncludeCss(
        ////"~/Content/themes/default/Site.css",
        ////"~/Content/themes/default/jquery-ui-1.8.2.custom.css",
        //"~/Content/zTreeStyle/zTreeStyle.css",        
        //"~/Content/ui.jqgrid.css",
        //"~/Content/jquery.pnotify.default.css",
        //"~/Content/jq.ui.datetimepicker.css",
        //"~/Content/public.css",
        //"~/Content/master.css"
        
        
        "~/Content/themes/default/Site.css",
        "~/Content/zTreeStyle/zTreeStyle.css",
        "~/Content/themes/default/jquery-ui-1.8.2.custom.css",
        "~/Content/ui.jqgrid.css",
        "~/Content/jquery.pnotify.default.css",
        "~/Content/jq.ui.datetimepicker.css",
        "~/Content/public.css",
        "~/Content/master.css"
        );     
  
}
@using MvcContrib.IncludeHandling
@model ZLERP.Model.ViewModels.HomeViewModel
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>@ViewBag.Title - @Lang.Global_ProductName</title>
    <meta name="keywords" content="搅拌站ERP,ERP,中联重科ERP,搅拌站信息化" />
    <meta name="description" content="中联重科混凝土企业运营系统，简称中联搅拌站ERP是一套为混凝土企业量身定制的信息化企业管理软件" />
    <meta name="author" content="ZLERP3" />
    @Html.Raw(Html.RenderCss())
@*    <link href="@Url.Content("~/Content/themes/default/Site.css")" rel="stylesheet" type="text/css"  class="ui-theme"/>
    <link href="@Url.Content("~/Content/themes/default/jquery-ui-1.8.2.custom.css")" rel="stylesheet" class="ui-theme" type="text/css" />
    <link href="@Url.Content("~/Content/themes/default/Site.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/zTreeStyle/zTreeStyle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/themes/default/jquery-ui-1.8.2.custom.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/ui.jqgrid.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/jquery.pnotify.default.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/jq.ui.datetimepicker.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.4.4.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.messager.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.loadmask.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/common.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.pnotify.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/i18n/grid.locale-cn.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/i18n/jquery.ui.locale.zh-CN.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.jqGrid.min.js")" type="text/javascript"></script>    
    <script src="@Url.Content("~/Scripts/fg.menu.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/MyGrid.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ztree.core-3.0.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ztree.excheck-3.0.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.zlerp.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui-timepicker-addon.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.tmpl.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/ActReport.js")" type="text/javascript"></script>*@
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=ca7f3665a8a9f1b016e4ad982b85d313&plugin=AMap.Geocoder"></script>
    <script type="text/javascript">
    
    
    //kaifa s
        var gSysConfig = {};
        @foreach (var s in Model.SysConfigs)
        {@:gSysConfig["@s.ConfigName"] = "@s.ConfigValue";
        } 
        var gDics = @ViewBag.Dics;

    </script>
    <style type="text/css">
        .red
        {
            @*background: #ffff00;*@
            @*border: 1px solid red;*@
            color: #d00;
        }
    </style>

</head>
<body>
    @*<div id="favoriteMenu"> 
<ul>
<li><a href="#">菜单1</a></li>
<li><a href="#">菜单2</a></li>
<li><a href="#">菜单3</a></li>
<li><a href="#">菜单4</a></li>
<li><a href="#">菜单5</a></li>
</ul> 
<div class="ftitle ui-accordion-header ui-helper-reset ui-state-default ui-corner-bottom">
<span class="ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-e"></span>
<a href="javascript:void 0;" onclick="toggleFMenu()">快捷菜单</a>
</div>
</div>*@
    @if (TempData["LicenseInfo"] != null)
    {
        <div id="topinfo" class="ui-state-highlight">
            @Html.Raw(TempData["LicenseInfo"].ToString())
        </div>
    }
    <div id="header">
        <div class="welcome">
            @Html.Partial("_LogOnPartial")
        </div>
        <div id="companyInfo" style="text-align: left">
            <img src="@Url.Content("~/Content/erpimage/logo.png")" border="0" alt="logo" />
        </div>
        <div id="systemmsg_id" class="systemmsg">
            您有&nbsp;<strong><span id="msgcount" style="color: Red;"></span></strong>&nbsp;条系统消息需要处理，请到【桌面管理】进行查看</div>
    </div>
    <div id="menu">
        <div id="nav_top" style="overflow: hidden; width: 90%; height: 30px; float: left;">
            <div id="menuscroll" style="width: 20000px; height: 30px; padding: 0; margin: 0;">
                @foreach (var menu in Model.RootFuncs)
                {
                    <div>
                        <a  rev= "@menu.ID" title="@menu.Desc" href="javascript:void(0)">@menu.Name</a></div> 
                }
            </div>
        </div>
        <div class="scrollbtns">
            <a href="javascript:void 0;" id="moreLeft" onclick="moveMenu('right')" style="float: left;"
                class="moreLeft ui-icon ui-icon-circle-triangle-w"><<</a> <a href="javascript:void 0;"
                    id="moreRight" onclick="moveMenu('left')" class="moreRight ui-icon ui-icon-circle-triangle-e">
                    >></a>
        </div>
    </div>
    <div style="clear: both;">
    </div>
    <div class="menu_2" id="menu_2">
        <div class="menuscroll" id="submenuscroll">
            <ul class="scollbox" id="scollbox" style="left: 0px;">
            </ul>
            <div class="buttonwidth moremenu" id="buttonwidthMoremenu">
                <a href="javascript:void 0;" id="moreLeft" onclick="moveSubMenu(150)" style="float: left;"
                    class="moreLeft ui-icon ui-icon-circle-triangle-w"><<</a> <a href="javascript:void 0;"
                        id="moreRight" onclick="moveSubMenu(-150)" class="moreRight ui-icon ui-icon-circle-triangle-e">
                        >></a>
            </div>
        </div>
    </div>
    <div id="jplayer">
    </div>
    <div style="clear: both;">
    </div>
    @*<div id="unloaddiv">
    </div>*@
    <div id="main" style="padding-left: 5px;">
        <div id="unloaddiv" style="display: none">
        </div>
        <div id="container" style="float: left; width: 99%;">
        </div>
    </div>
    <!--END-->
    <div id="footer" style="text-align: center;">
        <span class="copyright" title="@ViewBag.AuthScheme">版权所有&copy; 2009-@DateTime.Today.Year 中联重科股份有限公司 </span>
        <span class="Feedback" style="padding-right: 10px;">
        在线人数:(<span style="color: red">@ViewBag.OnLineCount</span>)&nbsp;&nbsp;&nbsp; ERP版本:@Html.ERPVersion()</span>
        <span style="color: red">@ViewBag.LinceseInfo</span>
    </div>
    <div id="MyGrid-Dialog">
    </div>
    @Html.Raw(Html.RenderJs())
    <script type="text/javascript">  
    var subMenus =  @Html.Raw(Model.SubFuncs);
    var subMenuCache={};
    var loading = '<div style="text-align:center;color:#f90;font-weight:bold;position:absolute; left:50%; top:50%; z-index:10;"><img src="@Url.Content("~/Content/themes/default/images/ajax-loader.gif")" border="0" alt="数据加载中..."/><br/>数据加载中...</div>';

    var  currentActivePanelId;
    //打开菜单页面URL
    function openUrl(obj,url,pid){
            $("#unloaddiv").trigger("click");
   
            currentActivePanelId=url.substring(url.indexOf("f=")+2);
  
        var me = $(obj);
   
        if(me.parent().parent().attr('id') == "scollbox"){
            $(".menu_2_on").removeClass();
            me.parent().addClass("menu_2_on");
        }
        if(pid){
            var subTitle = '<span><div style="margin-top:3px;float:right;"  class="ui-icon ui-icon-triangle-1-s" ></div>'+me.html() + '</span>';
            $('#func_' + pid).html(subTitle);
        }
        if(url && url!=''){
            //$(document).mask('Loading...');
            $('#container').html(loading); 
            if(typeof(me.data("html")) == "undefined")
            {
                    $("#container").load(url, 
                    function (d) { 
                        //me.data("html", d);
                        initErpControls(); 
                        // $(document).unmask();
                    }
                    );
            }
            else
            {
                $("#container").html(me.data('html'));
                initErpControls(); 
                // $(document).unmask();
            }
        
        
        }
    } 
    //获取子菜单宽度 
    function getSubMenuWidth(){
        var subMenuInnerWidth = 0;
        $('#scollbox > li').each(function(){
            subMenuInnerWidth += $(this).width();
        });
        return subMenuInnerWidth;
    }

    function moveSubMenu(width){
        var subMenuInnerWidth = getSubMenuWidth();
        var scrollbox = $('#scollbox');
        var cur = scrollbox.css('margin-left').replace('px','');
        cur = parseInt(cur);
        var containerW = $('#submenuscroll').width() - 150;
        if(width< 0 && (containerW - cur) >= subMenuInnerWidth) return;  
        var vWidth = (cur + width); 
        if(vWidth > 0)
         cur = 0;
        else
            cur = vWidth;
        scrollbox.animate({'marginLeft': cur + 'px'});
    }
    function getMenuWidth(){
        var total = 0;
        $('#menuscroll > div').each(function(){
            total += $(this).width();
        });
        return total;
    }
    function moveMenu(dir){
        var innerScroll = $('#menuscroll');
        var containerWidth = $('#nav_top').width();
        var menuWidth = getMenuWidth();
        var marginLeft = innerScroll.css('marginLeft').replace('px','') * 1;
        if(dir == 'right'){
            if( marginLeft < 0){
                marginLeft = (marginLeft + 83);
                if(marginLeft >  0) marginLeft = 0;
                innerScroll.animate({'marginLeft': marginLeft + 'px'}); 
            }        
        }
        else if(dir=='left'){            
            if((menuWidth + marginLeft) > containerWidth){
                marginLeft = (marginLeft - 83);
                innerScroll.animate({'marginLeft': marginLeft + 'px'});
            }
        }
    }
 
    function appendFuncId(url,funcId){
        if(url.indexOf('?')>0)
            url += '&f=' + funcId;
        else
            url += '?f=' + funcId;
         return url;
    }
    //第三级菜单以下
    function renderSubMenu(parentId)
    {
        var mi = '<ul>';
        for(var i=0; i<subMenus.length;i++){
            var n = subMenus[i];
                          
            if(n.PID == parentId){
                if(n.IsL){
                   n.Url = appendFuncId(n.Url, n.ID);
                   //下一级菜单
                   mi += ' <li><a onclick=\'openUrl(this,"'+n.Url + '", "'+parentId+'")\' rev="'+n.ID+'" href="javascript:void(0)"  title="'+n.Url+'">'+n.Name+'</a></li>';
                }
                else{
                    mi += ' <li><a href="javascript:void(0)">'+n.Name+'</a>';
                    mi += renderSubMenu(n.ID);
                    mi += '</li>';
                } 
            }
        }
        mi += "</ul>";
        return mi;
    }
     
     function fixFooter() {
        var stripHeight = $(window).height()
        - $("#header").height()
        - $("#menu").height() - $("#menu_2").height();   //+ "px";

        $("#container").css('minHeight', stripHeight - $("#footer").height() - 15 + "px");

    }
    function ShowMsg()
    {
       $.messager.show(0,"<a href='javascript:void(0)' onclick='showMsgDialog();'>你有0条系统消息需要处理，请到【桌面管理】进行查看！</a>");
    }
    //推送消息
    function PushMsg(){
        var TaskAndFormulaUrl='@Url.Action("TaskAndFormula", "ProduceTask")'+"?f=5102";
        var GetUnDoMsg='@Url.Action("GetMyUndoMsg", "SystemMsg")';        

        ajaxRequest(GetUnDoMsg, {}, false, function (response) {
            if(response.Result&&response.Data>0){
                $("#systemmsg_id").fadeIn("fast");
                if(gSysConfig.IsUseMessageBeep == "true"){
                    //PlaySound();//因新版flash与firefox冲突问题暂时停用媒体播放，待更新后开放
                }
                shake($("#systemmsg_id"),"red",5);//闪烁提示,此方法在common.js里面
                $("#msgcount").text(response.Data);
                $("#unreadcount>font").text(response.Data);
            }else{
                $("#systemmsg_id").fadeOut("fast");
                $("#unreadcount>font").text(0);
            }
        });

    }
    //播放声音
    function PlaySound() {
		$("#jplayer").jPlayer('play');
		return true;
	}

    //切换皮肤
    function ChangeCss(locStr){
       var href="/Content/themes/"+ locStr+"/Site.css";
       var href2="/Content/themes/"+ locStr+"/jquery-ui-1.8.2.custom.css";
       var cssLink=$('<link href="'+href+'"type="text/css" rel="Stylesheet" class="ui-theme"/>');
       var cssLink2=$('<link href="'+href2+'"type="text/css" rel="Stylesheet" class="ui-theme"/>');
       $("head").append(cssLink);
       $("head").append(cssLink2);
       if($("link.ui-theme").size()>0)       
       {
          $("link.ui-theme:first").remove();
          $("link.ui-theme:first").remove();
       }
       //写入cookie
       $.cookie("css_skin",locStr,{ expires:30, path: '/'}) ;
    }
     //显示查看消息窗体
    function showMsgDialog()
    {
        $('#divShowMsg').dialog({
            width:500,
            height:300,
            modal:true,
            buttons:{
                     
                '取消':function(){
                    $(this).dialog('close');
                },
                '保存':function(){
                        
                }
            }
        });
    }
    //初始化入口
    jQuery(function ($) {    
        /*因新版flash与firefox冲突问题暂时停用媒体播放，待更新后开放
        $("#jplayer").jPlayer({
		  swfPath: "/Scripts/Jplayer.swf",
		  ready: function () {
			$(this).jPlayer("setMedia", {
			  mp3: "/Content/duanxin.mp3"
			});
		  },
		  supplied: "mp3"
		});
        */
        //如果cookie不为空的时候就读取cookie的路径 
        if($.cookie("css_skin")!=null) 
        { 
           var hr=$.cookie("css_skin");
           var sThemes=$("#styleswitch").val(hr);//下拉显示当前皮肤主题项
		   ChangeCss(hr);	
        } 

        fixFooter();   
        PushMsg();
        window.setInterval("PushMsg()",30000);//30秒刷新1次
        //ShowMsg();
        //window.setInterval("ShowMsg()",30000);//30秒刷新1次  
        $("#nav_top a").bind('click', function () {
            $(".active").removeClass();
            $(this).parent().addClass("active");
            $("#scollbox").empty();
            var pid = $(this).attr("rev");
            if(pid in subMenuCache){
                $("#scollbox").append(subMenuCache[pid]); 
                         
            }
            else{
                subMenuCache[pid] = ''; 
                $.each(subMenus, function (i, n) {
                    if(n.PID == pid){                   
                        if (n.IsL){
                            n.Url = appendFuncId(n.Url, n.ID);
                            //下一级菜单    
                            var menuHtml = '<li><a onclick= openUrl(this,"'+ n.Url + '") href="javascript:void(0)" rev="'+n.ID+'" title="'+n.Url+'"><span>'+n.Name+'</span></a></li>';
                            $("#scollbox").append(menuHtml);
                            subMenuCache[pid] += menuHtml;
                             
                        }
                        else{
                            var menuHtml = '<li><a id="func_'+n.ID+'" onclick="openUrl(this,\'\')" class="fgmenu" href="javascript:void(0)" ><span><div style="margin-top:3px;float:right;"  class="ui-icon ui-icon-triangle-1-s" ></div>'+n.Name+'</span></a><div style="display:none;">'+renderSubMenu(n.ID)+'</div></li>';
                            $("#scollbox").append(menuHtml);
                            subMenuCache[pid] += menuHtml; 
                            
                        }
                    }
                });                   
            }
                $('#scollbox').css('margin-left','0px');
           $('a.fgmenu','#scollbox').each(function(){
                 $(this).fgmenu({
			        content: $(this).next().html(),
                    flyOut: true
		        });
           });              
            $("#menu_2 a").first().click();
        });
        $("#menu a").first().click(); 
//        //初始化快捷菜单
//        $('#favoriteMenu ul').menu();
//        $('#favoriteMenu ul').removeClass('ui-corner-all');
//        $("body").bind("click",function(event){
//            if (!($(event.target).parents("#favoriteMenu").length > 0)) {
//                   $('#favoriteMenu>ul:visible').hide('blind','fast', function(){
//                        $('#favoriteMenu .ftitle span').toggleClass('ui-icon-triangle-1-e');
//                   });
//            };
//        });

       $('b.planclss').html("<font color='red'>"+ gSysConfig['PlanClass']+"</font>");

       //$('b.zt').html("<font color='red'>当前帐套："+ '@User.YearAccountID()'+"</font>");

       //$('b.zt').bind('click',function(){
       //    showAlert("提示", "切换帐套，请退出重新登录", null);
       //});
       $('b.zt').css('display','none');

       //帮助
       $('b.help').bind('click',function(){
       var _help_doc_url = '/help';
     
      var p = "fullscreen=0,width=1000,height=600,top=50,left=50,directories=0,toolbar=1,location=1,status=0,menubar=1,scrollbars=1,history=0,resizable=yes,location=no";
            //window.open(_help_doc_url + "/help.aspx?page=" + currentActivePanelId, "help", p, "nomenu");
            //        window.open(_help_doc_url + "/help.aspx?page=" + currentActivePanelId, "help", p);
            var wins=window.open(_help_doc_url + "/doc/中联混凝土企业运营系统(ERP)用户手册--标准版.pdf", "help", p, "nomenu"); 
            wins.document.title="中联混凝土企业运营系统(ERP)用户手册--标准版";
          });
//        $('b.help').css('display','none');

        //修改用户信息
        $('b.username').bind('click',function(){
            setFormValueWithPre($("#divEditUserInfo form"), '@Url.Action("Get", "User")', { id: '@User.UserID()' }, null,"User");
            $("#User_ID")[0].readOnly=true;
            $('#divEditUserInfo').dialog({
                width:750,
                height:400,
                modal:true,
                buttons:{                     
                    '取消':function(){
                        $(this).dialog('close');
                    },
                    '保存':function(){                     
                        
                        if (!$('#divEditUserInfo form').valid()) {
                            var valMsg = $('[data-valmsg-summary=true]');
                            if (valMsg.length > 0) {
                               valMsg.hide();
                               showError('验证错误', valMsg.html());
                             }
                           return;
                       }
                        var dialog = $(this);
                        ajaxRequest('@Url.Action("UpdateUser", "User")', $('form', dialog).serialize(), false, function(resp){
                            if(resp && resp.Result){
                                showMessage('用户信息修改成功');
                                dialog.dialog('close');
                            }
                            else{
                                showError(resp.Message);
                            }
                        });
                    }
                }
            });
            
        });
        //修改密码
        $('b.userpwd').bind('click',function(){
            $('#divEditUserPwd').dialog({
                width:300,
                height:200,
                modal:true,
                buttons:{
                     
                    '取消':function(){
                        $(this).dialog('close');
                    },
                    '保存':function(){
                        var password = $('[name=Password]', this);
                        if(isEmpty(password.val()))
                        {
                            showError('验证错误','请输入原始密码');
                            password.focus();
                            return;
                        }
                        
                        var newPass = $('[name=NewPassword]', this);
                        if(isEmpty(newPass.val()))
                        {
                            showError('验证错误','请输入新密码');
                            newPass.focus();
                            return;
                        }
                        if(newPass.val().length <6){
                             showError('验证错误','新密码长度最小为6位');
                            newPass.focus();
                            return;
                        }
                        var confirmPass = $('[name=ConfirmPassword]', this)
                        if(isEmpty(confirmPass.val()))
                        {
                            showError('验证错误','请确认新密码');
                            confirmPass.focus();
                            return;
                        }
                        if(confirmPass.val() != newPass.val()){
                            showError('验证错误','两次输入的密码不一致');
                            confirmPass.focus();
                            return;
                        }
                        var dialog = $(this);
                        ajaxRequest('@Url.Action("ModifyPass", "User")', $('form', dialog).serialize(), false, function(resp){
                            if(resp && resp.Result){
                                showMessage('密码修改成功');
                                dialog.dialog('close');
                            }
                            else{
                                showError(resp.Message);
                            }
                        });
                    }
                }
            });
        });

        //清空缓存
        $('b.refreshCache').bind('click', function() {
            ajaxRequest('/SysConfig.mvc/RefreshCache', null, true);
        });

        //皮肤切换
        $('b.changeThemes').bind('click',function(){
            $('#divChangeThemes').dialog({
                width:300,
                height:150,
                modal:true,
                buttons:{
                     
                    '取消':function(){
                        $(this).dialog('close');
                    },
                    '保存':function(){
                        var password = $('[name=theme]', this);
                        if(isEmpty(password.val()))
                        {
                            showError('验证错误','请选择皮肤主题！');
                            return;
                        }
                                               
                        var dialog = $(this);
                        var locStr = $("#styleswitch").val();
                        ChangeCss(locStr);
                        showMessage('提示','切换成功');
                        dialog.dialog('close');
                    }
                }
            });
        });
       
        $('#topinfo')  
        .effect('bounce') 
        .delay(5000)
        .effect('blind');
        
        //菜单滚动按钮
        var containerWidth = $('#nav_top').width();
        var menuWidth = getMenuWidth();
        if(menuWidth > containerWidth){
            $('#menu .scrollbtns').show();
            $('#nav_top').width($('#menu').width() -80 + 'px');
        }

        
    });
    </script>
    <div id="divEditUserInfo" title="用户基本信息" style="display: none">
        @using (Html.BeginForm())
        { 
            @Html.ValidationSummary()
            <table class="mvcform">
                @Html.HiddenFor(m => m.User.ID)
                <tr>
                    <td>
                        @Html.LabelFor(m => m.User.ID)@Html.TextBoxFor(m => m.User.ID, new { disabled = true })
                    </td>
                    <td>@Html.LabelFor(m => m.User.DepartmentID)@Html.DropDownListFor(m => m.User.DepartmentID, (IEnumerable<SelectListItem>)ViewBag.DepartmentList, new { @class = "text" })
                    </td>
                    <td>@Html.LabelFor(m => m.User.TrueName)@Html.EditorFor(m => m.User.TrueName)
                    </td>
                </tr>
                <!---->
                <tr>
                    <td>@Html.LabelFor(m => m.User.Mobile)@Html.EditorFor(m => m.User.Mobile)
                    </td>
                    <td>@Html.LabelFor(m => m.User.ManagerID)@Html.AutoComplete("User.ManagerID", "ManageName", "Combo", "User", "ID", "TrueName")
                    </td>
                </tr>
                <tr>
                    <td>@Html.LabelFor(m => m.User.CommAddr)@Html.EditorFor(m => m.User.CommAddr)
                    </td>
                    <td>@Html.LabelFor(m => m.User.NationAddr)@Html.EditorFor(m => m.User.NationAddr)
                    </td>
                    <td>@Html.LabelFor(m => m.User.IDCard)@Html.EditorFor(m => m.User.IDCard)
                    </td>
                </tr>
                <tr>
                    <td>@Html.LabelFor(m => m.User.PostCode)@Html.EditorFor(m => m.User.PostCode)
                    </td>
                    <td>@Html.LabelFor(m => m.User.BloodType)@Html.EditorFor(m => m.User.BloodType)
                    </td>
                    <td>@Html.LabelFor(m => m.User.Sex)@Html.DicEditorFor(m => m.User.Sex, DicEnum.Gender)
                    </td>
                </tr>
                <tr>
                    <td>@Html.LabelFor(m => m.User.IsMarried)@Html.CheckBoxFor(m => m.User.IsMarried)
                    </td>
                    <td>@Html.LabelFor(m => m.User.MaxEducate)@Html.EditorFor(m => m.User.MaxEducate)
                    </td>
                    <td>@Html.LabelFor(m => m.User.BankID)@Html.EditorFor(m => m.User.BankID)
                    </td>
                </tr>
                <tr>
                    <td>@Html.LabelFor(m => m.User.Nation)@Html.EditorFor(m => m.User.Nation)
                    </td>
                    <td>@Html.LabelFor(m => m.User.Birthday)@Html.EditorFor(m => m.User.Birthday)
                    </td>
                    <td>@Html.LabelFor(m => m.User.DigitSign)@Html.EditorFor(m => m.User.DigitSign)
                    </td>
                </tr>
                <tr>
                    <td>@Html.LabelFor(m => m.User.DriverIdentity)@Html.EditorFor(m => m.User.DriverIdentity)
                    </td>
                    <td>@Html.LabelFor(m => m.User.Email)@Html.EditorFor(m => m.User.Email)
                    </td>
                    <td>@Html.LabelFor(m => m.User.Tel)@Html.EditorFor(m => m.User.Tel)
                    </td>
                </tr>
                <tr>
                    <td colspan="3">@Html.LabelFor(m => m.User.Remark)@Html.TextAreaFor(m => m.User.Remark, new { style = "width:80%" })
                    </td>
                </tr>
            </table>
        
        }
    </div>

    <div id="divEditUserPwd" title="修改密码" class="mvcform" style="display: none">
        @using (Html.BeginForm())
        { 
            <table>
                <tr>
                    <td>
                        原密码：
                    </td>
                    <td>
                        <input type="password" class="requiredval" name="Password" />
                    </td>
                </tr>
                <tr>
                    <td>
                        新密码：
                    </td>
                    <td>
                        <input type="password" class="requiredval" name="NewPassword" />
                    </td>
                </tr>
                <tr>
                    <td>
                        再次输入新密码：
                    </td>
                    <td>
                        <input type="password" class="requiredval" name="ConfirmPassword" />
                    </td>
                </tr>
            </table>
        
        }
    </div>

    <div id="divChangeThemes" title="切换皮肤" class="mvcform" style="display: none">
        @using (Html.BeginForm())
        { 
            <table>
                <tr>
                    <td>
                        主题皮肤：
                    </td>
                    <td>
                        <select name="theme" id="styleswitch">
                            <option value="default">默认</option>
                            <option value="zlgreen">绿色</option>
                            @*<option value="base">基本</option>*@
                            <option value="humanity">人文黄</option>
                            <option value="excite-bike">蓝黄条纹</option>
                            

                        </select>

                    </td>
                </tr>
            </table>
        
        }
    </div>
    <div id="divShowMsg" title="显示消息" class="mvcform" style="display: none">
        
    </div>

    <div id="div_excel_erp" style="display: none">
        <table id="table_excel_erp">
        </table>
        <div id="div_page_erp">
        </div>
    </div>
    <div id="div_map_dialog">
    </div>
</body>
</html>
